SOURCE_DIR=${PWD}/src
OBJ_DIR=${PWD}/obj
INSTALL_DIR=${PWD}/bin
CFLAGS_OPT=-O2 -ftree-vectorize -msse2

TARGET_OPT_BASE=optBase
TARGET_BASE=base
TARGET_FIN=fin

all: install_opt install_base install_fin

install_base: ${INSTALL_DIR}/${TARGET_BASE}

${INSTALL_DIR}/${TARGET_BASE}: ${OBJ_DIR}/${TARGET_BASE}.o
	gcc ${OBJ_DIR}/${TARGET_BASE}.o -o ${INSTALL_DIR}/${TARGET_BASE}

${OBJ_DIR}/${TARGET_BASE}.o: ${SOURCE_DIR}/${TARGET_BASE}.c
	gcc -c -O0 ${SOURCE_DIR}/${TARGET_BASE}.c -o ${OBJ_DIR}/${TARGET_BASE}.o

install_opt: ${INSTALL_DIR}/${TARGET_OPT_BASE}

${INSTALL_DIR}/${TARGET_OPT_BASE}: ${OBJ_DIR}/${TARGET_OPT_BASE}.o
	gcc ${OBJ_DIR}/${TARGET_OPT_BASE}.o -o ${INSTALL_DIR}/${TARGET_OPT_BASE}
${OBJ_DIR}/${TARGET_OPT_BASE}.o: ${SOURCE_DIR}/${TARGET_BASE}.c
	gcc -c ${CFLAGS_OPT} ${SOURCE_DIR}/${TARGET_BASE}.c -o ${OBJ_DIR}/${TARGET_OPT_BASE}.o

install_fin: ${INSTALL_DIR}/${TARGET_FIN}

${INSTALL_DIR}/${TARGET_FIN}: ${OBJ_DIR}/${TARGET_FIN}.o
	gcc ${OBJ_DIR}/${TARGET_FIN}.o -o ${INSTALL_DIR}/${TARGET_FIN}
${OBJ_DIR}/${TARGET_FIN}.o: ${SOURCE_DIR}/${TARGET_FIN}.c
	gcc -c -O0 ${SOURCE_DIR}/${TARGET_FIN}.c -o ${OBJ_DIR}/${TARGET_FIN}.o

disassembly: disasm_base disasm_optBase

disasm_base: ${SOURCE_DIR}/${TARGET_BASE}.s

${SOURCE_DIR}/${TARGET_BASE}.s: ${SOURCE_DIR}/${TARGET_BASE}.c
	gcc -O0 -S ${SOURCE_DIR}/${TARGET_BASE}.c -o ${SOURCE_DIR}/${TARGET_BASE}.s

disasm_optBase: ${SOURCE_DIR}/${TARGET_OPT_BASE}.s

${SOURCE_DIR}/${TARGET_OPT_BASE}.s: ${SOURCE_DIR}/${TARGET_BASE}.c
	gcc ${CFLAGS_OPT} -S ${SOURCE_DIR}/${TARGET_BASE}.c -o ${SOURCE_DIR}/${TARGET_OPT_BASE}.s

clean:
	rm ${INSTALL_DIR}/* ${OBJ_DIR}/* ${SOURCE_DIR}/*.s
